#!/bin/bash

echo "ğŸ”§ Creating storage folders..."
mkdir -p storage/framework/{cache,sessions,views} storage/logs

echo "ğŸ“„ Copying .env file..."
cp .env.example .env

# Ø«Ø§Ø¨ØªÙŠÙ†
dbuser="root"
dbpass="123456"

# Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙ‚Ø·
read -p "Database Name: " dbname

# ØªØ¹Ø¯ÙŠÙ„ Ù…Ù„Ù .env
sed -i "s/DB_DATABASE=.*/DB_DATABASE=${dbname}/" .env
sed -i "s/DB_USERNAME=.*/DB_USERNAME=${dbuser}/" .env
sed -i "s/DB_PASSWORD=.*/DB_PASSWORD=${dbpass}/" .env

# Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ùˆ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯Ø©
echo "ğŸ—„ï¸  Checking if database exists..."
DB_EXISTS=$(mysql -u${dbuser} -p${dbpass} -e "SHOW DATABASES LIKE '${dbname}';" 2>/dev/null | grep "${dbname}" > /dev/null; echo $?)

if [ $DB_EXISTS -ne 0 ]; then
    echo "ğŸ“¦ Creating database '${dbname}'..."
    mysql -u${dbuser} -p${dbpass} -e "CREATE DATABASE \`${dbname}\`;" || { echo "âŒ Failed to create database."; exit 1; }
else
    echo "âœ… Database '${dbname}' already exists."
fi

echo "ğŸ”‘ Generating app key..."
php artisan key:generate

echo "ğŸ“¦ Running composer update..."
composer update

echo "ğŸ§± Running migrations..."
php artisan migrate --seed || { echo "âŒ Migration failed."; exit 1; }

echo "âœ… Setup complete!"
